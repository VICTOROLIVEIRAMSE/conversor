<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversor de Unidades PRO</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f0f2f5;
            --sidebar-bg: #1f2937;
            --card-bg: #ffffff;
            --primary-accent: #3b82f6;
            --text-dark: #111827;
            --text-light: #d1d5db;
            --text-sidebar-active: #ffffff;
            --border-color: #e5e7eb;
            --shadow-color: rgba(0, 0, 0, 0.05);
            --input-bg: #ffffff;
            --success-color: #22c55e;
        }

        :root[data-theme='dark'] {
            --bg-color: #111827;
            --sidebar-bg: #1f2937;
            --card-bg: #374151;
            --primary-accent: #60a5fa;
            --text-dark: #d1d5db;
            --text-light: #9ca3af;
            --text-sidebar-active: #ffffff;
            --border-color: #4b5563;
            --shadow-color: rgba(0, 0, 0, 0.2);
            --input-bg: #4b5563;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-dark);
            display: flex;
            transition: background-color 0.3s, color 0.3s;
        }

        #sidebar {
            width: 260px;
            background-color: var(--sidebar-bg);
            color: var(--text-light);
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            padding: 20px 0;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border-color);
        }

        #sidebar h1 {
            font-size: 1.5rem;
            padding: 0 20px 20px 20px;
            color: var(--text-sidebar-active);
            border-bottom: 1px solid #374151;
            margin-bottom: 10px;
        }
        
        #search-box {
            margin: 0 20px 10px 20px;
        }
        
        #search-input {
            width: 100%;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #4b5563;
            background-color: #374151;
            color: var(--text-light);
            font-family: 'Inter', sans-serif;
        }

        #sidebar nav {
            overflow-y: auto;
        }

        #sidebar nav ul {
            list-style: none;
        }

        #sidebar nav a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: var(--text-light);
            text-decoration: none;
            font-weight: 500;
            transition: background-color 0.2s ease, color 0.2s ease;
            border-left: 3px solid transparent;
        }
        
        #sidebar nav a .icon {
            width: 20px;
            height: 20px;
        }

        #sidebar nav a:hover {
            background-color: #374151;
        }

        #sidebar nav a.active {
            background-color: var(--primary-accent);
            color: var(--text-sidebar-active);
        }
        
        #sidebar .footer {
            margin-top: auto;
            padding: 20px;
            font-size: 0.8rem;
            color: #6b7280;
            text-align: center;
            border-top: 1px solid #374151;
        }

        .theme-switcher {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            cursor: pointer;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }

        .switch input { display: none; }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #4b5563;
            transition: .4s;
            border-radius: 20px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 14px; width: 14px;
            left: 3px; bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider { background-color: var(--primary-accent); }
        input:checked + .slider:before { transform: translateX(20px); }

        #main-content {
            margin-left: 260px;
            padding: 30px;
            width: calc(100% - 260px);
        }

        .converter-section { display: none; }
        .converter-section.active { display: block; }

        .converter-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px -1px var(--shadow-color), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: background-color 0.3s, border-color 0.3s;
        }
        
        .converter-card h3 {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: var(--text-dark);
        }

        .conversion-row, .calculator-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-group {
            flex: 1;
            display: flex;
            position: relative;
            flex-direction: column;
        }

        .input-group label {
            font-size: 0.9rem;
            margin-bottom: 5px;
            color: #6b7280;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            background-color: var(--input-bg);
            color: var(--text-dark);
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        
        .input-group input {
             padding-right: 40px; /* Space for copy button */
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: var(--primary-accent);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        
        .copy-btn {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(calc(-50% + 10px));
            width: 30px;
            height: 30px;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            opacity: 0.6;
        }
        .copy-btn:hover { opacity: 1; background-color: rgba(0,0,0,0.1); }
        .copy-btn.copied { stroke: var(--success-color); }
        
        .swap-btn {
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 36px;
            height: 36px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
            transition: background-color 0.2s, transform 0.2s;
        }
        .swap-btn:hover { background-color: var(--bg-color); }
        .swap-btn:active { transform: rotate(180deg); }

        .equals-sign { display: none; } /* Replaced by swap button */
        
        #fractional-result, .result-display {
            font-weight: 500;
            color: var(--primary-accent);
            font-size: 1rem;
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 10px;
            min-height: 42.5px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body { flex-direction: column; }
            #sidebar {
                width: 100%;
                height: auto;
                position: relative;
                flex-direction: column;
                padding-bottom: 10px;
            }
            #sidebar nav { max-height: 150px; }
            #main-content {
                margin-left: 0;
                width: 100%;
                padding: 20px;
            }
            .conversion-row, .calculator-row {
                flex-direction: column;
                align-items: stretch;
            }
            .swap-btn {
                align-self: center;
                margin-top: 5px;
                margin-bottom: 5px;
            }
        }
    </style>
</head>
<body>

    <aside id="sidebar">
        <h1>Conversor PRO</h1>
        <div id="search-box">
            <input type="search" id="search-input" placeholder="Buscar categoria...">
        </div>
        <nav>
            <ul id="menu-list">
                <li><a href="#comprimento" class="nav-link active"><svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>Comprimento</a></li>
                <li><a href="#temperatura" class="nav-link"><svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 10a4 4 0 10-8 0 4 4 0 008 0zm-4 7.5V19m-4-6.5a4 4 0 118 0 4 4 0 01-8 0zM9 10a1 1 0 100-2 1 1 0 000 2z"></path></svg>Temperatura</a></li>
                <li><a href="#area" class="nav-link"><svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 2h18v20H3zM21 2l-8.5 8.5M3 22l8.5-8.5"></path></svg>Área</a></li>
                <li><a href="#volume" class="nav-link"><svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4-8-4V7"></path></svg>Volume</a></li>
                <li><a href="#massa" class="nav-link"><svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4m16 0a8 8 0 11-16 0 8 8 0 0116 0z"></path></svg>Massa</a></li>
                <li><a href="#forca" class="nav-link"><svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>Força</a></li>
                <li><a href="#pressao" class="nav-link"><svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8s-9-3.582-9-8 4.03-8 9-8 9 3.582 9 8z"></path></svg>Pressão</a></li>
                <li><a href="#velocidade" class="nav-link"><svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"></path></svg>Velocidade</a></li>
                <li><a href="#torque" class="nav-link"><svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.414 1.414l-2.828 2.828a2 2 0 01-2.828 0l-4.243-4.243a2 2 0 010-2.828l2.828-2.828a2 2 0 001.414-1.414l-1.414-1.414a2 2 0 010-2.828l4.243-4.243a2 2 0 012.828 0l1.414 1.414a2 2 0 001.414-1.414l1.414-1.414a2 2 0 012.828 0l2.828 2.828a2 2 0 010 2.828l-1.414 1.414z"></path></svg>Torque</a></li>
                <li><a href="#potencia" class="nav-link"><svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 16v-2m8-8h2M4 12H2m15.364 6.364l1.414 1.414M4.222 4.222l1.414 1.414m12.728 0l-1.414 1.414M5.636 18.364l-1.414 1.414"></path></svg>Potência</a></li>
                <li><a href="#energia" class="nav-link"><svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M19 3v4M3 10h18M5 14h14M5 18h14M3 22h18"></path></svg>Energia</a></li>
                <li><a href="#densidade" class="nav-link"><svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 4v0a2 2 0 012-2h2a2 2 0 012 2v0m-6 8v0a2 2 0 012-2h2a2 2 0 012 2v0m-6 8v0a2 2 0 012-2h2a2 2 0 012 2v0M9 4h6v16H9V4z"></path></svg>Densidade</a></li>
                <li><a href="#vazao" class="nav-link"><svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>Vazão</a></li>
                <li><a href="#rugosidade" class="nav-link"><svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12h2M19 12h2M6 6l-2 2M18 6l2 2M6 18l-2-2M18 18l2-2"></path></svg>Rugosidade</a></li>
                <li><a href="#angulo" class="nav-link"><svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>Ângulo</a></li>
            </ul>
        </nav>
        <div class="footer">
            <div class="theme-switcher">
                <span>Light</span>
                <label class="switch">
                    <input type="checkbox" id="theme-toggle">
                    <span class="slider"></span>
                </label>
                <span>Dark</span>
            </div>
        </div>
    </aside>

    <main id="main-content">
        <!-- Sections will be dynamically displayed here -->
    </main>

    <script>
        // --- Full App Logic ---
        document.addEventListener('DOMContentLoaded', function() {
            
            // --- UI Elements ---
            const mainContent = document.getElementById('main-content');
            const navLinks = document.querySelectorAll('.nav-link');
            const menuList = document.getElementById('menu-list');
            const searchInput = document.getElementById('search-input');
            const themeToggle = document.getElementById('theme-toggle');

            // --- Data & State ---
            const sectionsData = {
                comprimento: { title: 'Comprimento', conversions: [
                    { title: 'Milímetro (mm) ↔ Polegada (in)', units: ['mm', 'inch-dec'], special: 'fractional' },
                    { title: 'Metro (m) ↔ Pé (ft)', units: ['m', 'ft'] },
                    { title: 'Quilômetro (km) ↔ Milha (mi)', units: ['km', 'mi'] }
                ]},
                temperatura: { title: 'Temperatura', conversions: [
                    { title: 'Celsius (°C) ↔ Fahrenheit (°F) ↔ Kelvin (K)', units: ['celsius', 'fahrenheit', 'kelvin'], type: 'temperature' }
                ]},
                area: { title: 'Área', conversions: [
                    { title: 'Metro Quadrado (m²) ↔ Pé Quadrado (ft²)', units: ['m2', 'ft2'] },
                    { title: 'Hectare (ha) ↔ Acre (acre)', units: ['ha', 'acre'] }
                ]},
                volume: { title: 'Volume', conversions: [
                    { title: 'Litro (L) ↔ Galão Americano (gal)', units: ['l', 'gal'] },
                    { title: 'Metro Cúbico (m³) ↔ Pé Cúbico (ft³)', units: ['m3', 'ft3'] }
                ]},
                massa: { title: 'Massa', conversions: [
                    { title: 'Quilograma (kg) ↔ Libra (lb)', units: ['kg', 'lb'] },
                    { title: 'Grama (g) ↔ Onça (oz)', units: ['g', 'oz'] }
                ]},
                forca: { title: 'Força', conversions: [
                    { title: 'Newton (N) ↔ Libra-força (lbf)', units: ['n', 'lbf'] },
                    { title: 'Quilonewton (kN) ↔ Kip (kilopound-force)', units: ['kn', 'kip'] }
                ]},
                pressao: { title: 'Pressão', conversions: [
                    { title: 'Quilopascal (kPa) ↔ PSI (lbf/in²)', units: ['kpa', 'psi'] },
                    { title: 'Megapascal (MPa) ↔ Kip por Polegada² (ksi)', units: ['mpa', 'ksi'] },
                    { title: 'Bar ↔ Atmosfera (atm)', units: ['bar', 'atm'] }
                ]},
                velocidade: { title: 'Velocidade', conversions: [
                    { title: 'Metros por segundo (m/s) ↔ Pés por segundo (ft/s)', units: ['mps', 'ftps'] },
                    { title: 'Quilômetros por hora (km/h) ↔ Milhas por hora (mph)', units: ['kmh', 'mph'] }
                ]},
                torque: { title: 'Torque', conversions: [
                    { title: 'Newton-metro (N·m) ↔ Libra-força-pé (lbf·ft)', units: ['nm', 'lbfft'] }
                ]},
                potencia: { title: 'Potência', conversions: [
                    { title: 'Quilowatt (kW) ↔ Horsepower (hp)', units: ['kw', 'hp'] }
                ]},
                energia: { title: 'Energia', conversions: [
                    { title: 'Joule (J) ↔ British Thermal Unit (BTU)', units: ['j', 'btu'] }
                ]},
                densidade: { title: 'Densidade', conversions: [
                    { title: 'kg/m³ ↔ lb/ft³', units: ['kgm3', 'lbft3'] }
                ]},
                vazao: { title: 'Vazão', conversions: [
                    { title: 'Litros por segundo (L/s) ↔ Galões por minuto (GPM)', units: ['lps', 'gpm'] },
                    { title: 'Metros cúbicos por hora (m³/h) ↔ Pés cúbicos por minuto (CFM)', units: ['m3h', 'cfm'] },
                    { title: 'Metros cúbicos por segundo (m³/s) ↔ Litros por segundo (L/s)', units: ['m3s', 'lps_2'] }
                ]},
                rugosidade: { title: 'Rugosidade de Tubulação', calculators: [
                    { title: 'Rugosidade Absoluta (k) por Material', type: 'roughness', materials: {
                        'Aço Rebitado Novo': 1.5,
                        'Concreto': 1.0,
                        'Madeira': 0.5,
                        'Ferro Fundido': 0.26,
                        'Aço Galvanizado': 0.15,
                        'Aço Comercial ou Soldado': 0.046,
                        'Ferro Forjado': 0.046,
                        'Tubo Puxado (Aço, Latão, Cobre)': 0.0015,
                        'PVC e Vidro': 0.0015
                    }}
                ]},
                angulo: { title: 'Ângulo e Inclinação', conversions: [
                    { title: 'Inclinação (%) ↔ Ângulo (°)', units: ['percent', 'deg'], type: 'angle' }
                ]}
            };

            const unitLabels = {
                'mm': 'Milímetros (mm)', 'inch-dec': 'Polegadas (in)', 'm': 'Metros (m)', 'ft': 'Pés (ft)', 'km': 'Quilômetros (km)', 'mi': 'Milhas (mi)',
                'celsius': 'Celsius (°C)', 'fahrenheit': 'Fahrenheit (°F)', 'kelvin': 'Kelvin (K)',
                'm2': 'm²', 'ft2': 'ft²', 'ha': 'Hectares (ha)', 'acre': 'Acres',
                'l': 'Litros (L)', 'gal': 'Galões (gal)', 'm3': 'm³', 'ft3': 'ft³',
                'kg': 'Quilogramas (kg)', 'lb': 'Libras (lb)', 'g': 'Gramas (g)', 'oz': 'Onças (oz)',
                'n': 'Newtons (N)', 'lbf': 'Libras-força (lbf)', 'kn': 'Quilonewtons (kN)', 'kip': 'Kips',
                'kpa': 'Quilopascals (kPa)', 'psi': 'PSI (lbf/in²)', 'mpa': 'Megapascals (MPa)', 'ksi': 'Kip/in² (ksi)', 'bar': 'Bar', 'atm': 'Atmosferas (atm)',
                'mps': 'm/s', 'ftps': 'ft/s', 'kmh': 'km/h', 'mph': 'mph',
                'nm': 'N·m', 'lbfft': 'lbf·ft',
                'kw': 'Quilowatts (kW)', 'hp': 'Horsepower (hp)',
                'j': 'Joules (J)', 'btu': 'BTUs',
                'kgm3': 'kg/m³', 'lbft3': 'lb/ft³',
                'lps': 'L/s', 'gpm': 'GPM', 'm3h': 'm³/h', 'cfm': 'CFM', 'm3s': 'm³/s', 'lps_2': 'L/s',
                'percent': 'Inclinação (%)', 'deg': 'Ângulo (°)'
            };

            // --- HTML Generation ---
            function createInputGroup(unitId) {
                return `
                    <div class="input-group" data-unit-id="${unitId}">
                        <label for="${unitId}">${unitLabels[unitId]}</label>
                        <input type="number" id="${unitId}" step="any" oninput="convert(this.id, this.value)">
                        <button class="copy-btn" onclick="copyToClipboard('${unitId}', this)" title="Copiar valor">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                        </button>
                    </div>
                `;
            }

            function buildSections() {
                for (const key in sectionsData) {
                    const sectionData = sectionsData[key];
                    const sectionEl = document.createElement('section');
                    sectionEl.id = key;
                    sectionEl.className = 'converter-section';
                    
                    let content = `<h2>${sectionData.title}</h2>`;
                    
                    if (sectionData.conversions) {
                        sectionData.conversions.forEach(conv => {
                            content += `<div class="converter-card" data-type="${conv.type || 'standard'}"><h3>${conv.title}</h3>`;
                            const groups = conv.units.map(unit => createInputGroup(unit)).join(`
                                <button class="swap-btn" onclick="swapUnits(this)" title="Inverter unidades">
                                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 12l-4-4m4 4l4-4m6 8v-12m0 12l4-4m-4 4l-4-4"></path></svg>
                                </button>
                            `);
                            content += `<div class="conversion-row">${groups}</div>`;
                            if (conv.special === 'fractional') {
                                content += `<div class="conversion-row" style="margin-top: 15px;"><div class="input-group"><label>Polegadas Fracionárias (aprox.)</label><div id="fractional-result" class="result-display">-</div></div></div>`;
                            }
                            content += `</div>`;
                        });
                    }

                    if (sectionData.calculators) {
                        sectionData.calculators.forEach(calc => {
                             if (calc.type === 'roughness') {
                                content += `<div class="converter-card"><h3>${calc.title}</h3><div class="calculator-row">`;
                                const options = Object.keys(calc.materials).map(mat => `<option value="${calc.materials[mat]}">${mat}</option>`).join('');
                                content += `
                                    <div class="input-group">
                                        <label for="material-select">Material</label>
                                        <select id="material-select" onchange="updateRoughness(this)">
                                            <option value="">-- Selecione um material --</option>
                                            ${options}
                                        </select>
                                    </div>
                                    <div class="input-group">
                                        <label>Rugosidade Absoluta (k)</label>
                                        <div id="roughness-result" class="result-display">-</div>
                                    </div>
                                </div></div>`;
                             }
                        });
                    }
                    
                    sectionEl.innerHTML = content;
                    mainContent.appendChild(sectionEl);
                }
            }

            // --- Navigation & UI ---
            function changeSection(hash) {
                const targetHash = hash || '#comprimento';
                navLinks.forEach(link => link.classList.toggle('active', link.hash === targetHash));
                document.querySelectorAll('.converter-section').forEach(section => {
                    section.classList.toggle('active', '#' + section.id === targetHash);
                });
            }

            searchInput.addEventListener('keyup', () => {
                const filter = searchInput.value.toLowerCase();
                menuList.querySelectorAll('li').forEach(li => {
                    const text = li.textContent.toLowerCase();
                    li.style.display = text.includes(filter) ? '' : 'none';
                });
            });
            
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    history.pushState(null, '', this.hash);
                    changeSection(this.hash);
                });
            });

            window.addEventListener('popstate', () => changeSection(window.location.hash));

            // --- Theme ---
            function applyTheme(theme) {
                document.documentElement.setAttribute('data-theme', theme);
                themeToggle.checked = theme === 'dark';
            }
            themeToggle.addEventListener('change', () => {
                const newTheme = themeToggle.checked ? 'dark' : 'light';
                localStorage.setItem('theme', newTheme);
                applyTheme(newTheme);
            });

            // --- Init ---
            buildSections();
            changeSection(window.location.hash);
            applyTheme(localStorage.getItem('theme') || 'light');
        });

        // --- Global Functions ---
        const factors = {
            'mm': { factor: 1 / 25.4 }, 'inch-dec': { factor: 25.4 },
            'm': { factor: 3.28084 }, 'ft': { factor: 1 / 3.28084 },
            'km': { factor: 0.621371 }, 'mi': { factor: 1.60934 },
            'm2': { factor: 10.7639 }, 'ft2': { factor: 1 / 10.7639 },
            'ha': { factor: 2.47105 }, 'acre': { factor: 1 / 2.47105 },
            'l': { factor: 0.264172 }, 'gal': { factor: 3.78541 },
            'm3': { factor: 35.3147 }, 'ft3': { factor: 1 / 35.3147 },
            'kg': { factor: 2.20462 }, 'lb': { factor: 1 / 2.20462 },
            'g': { factor: 0.035274 }, 'oz': { factor: 1 / 0.035274 },
            'n': { factor: 0.224809 }, 'lbf': { factor: 4.44822 },
            'kn': { factor: 0.224809 }, 'kip': { factor: 4.44822 },
            'kpa': { factor: 0.145038 }, 'psi': { factor: 6.89476 },
            'mpa': { factor: 0.145038 }, 'ksi': { factor: 6.89476 },
            'bar': { factor: 0.986923 }, 'atm': { factor: 1.01325 },
            'mps': { factor: 3.28084 }, 'ftps': { factor: 1 / 3.28084 },
            'kmh': { factor: 0.621371 }, 'mph': { factor: 1.60934 },
            'nm': { factor: 0.737562 }, 'lbfft': { factor: 1.35582 },
            'kw': { factor: 1.34102 }, 'hp': { factor: 0.7457 },
            'j': { factor: 0.000947817 }, 'btu': { factor: 1055.06 },
            'kgm3': { factor: 0.062428 }, 'lbft3': { factor: 16.0185 },
            'lps': { factor: 15.8503 }, 'gpm': { factor: 1 / 15.8503 },
            'm3h': { factor: 0.588578 }, 'cfm': { factor: 1 / 0.588578 },
            'm3s': { factor: 1000 }, 'lps_2': { factor: 1 / 1000 }
        };

        function gcd(a, b) { return b ? gcd(b, a % b) : a; }

        function toFractionalInch(decimalInches) {
            if (isNaN(decimalInches) || decimalInches === 0) return '-';
            const whole = Math.floor(decimalInches);
            const fraction = decimalInches - whole;
            if (fraction < 0.001) return `${whole}"`;
            const denominator = 64;
            let numerator = Math.round(fraction * denominator);
            if (numerator === 0) return `≈ ${whole}"`;
            if (numerator === denominator) return `${whole + 1}"`;
            const divisor = gcd(numerator, denominator);
            return (whole > 0 ? `${whole} ` : '') + `${numerator / divisor}/${denominator / divisor}"`;
        }
        
        function copyToClipboard(inputId, btn) {
            const input = document.getElementById(inputId);
            navigator.clipboard.writeText(input.value).then(() => {
                btn.classList.add('copied');
                setTimeout(() => btn.classList.remove('copied'), 1500);
            });
        }
        
        function swapUnits(btn) {
            const row = btn.closest('.conversion-row');
            const groups = row.querySelectorAll('.input-group');
            row.insertBefore(groups[1], groups[0]);
            groups.forEach(g => g.querySelector('input').value = '');
            const fractionalResult = row.parentElement.querySelector('#fractional-result');
            if(fractionalResult) fractionalResult.innerHTML = '-';
        }
        
        function updateRoughness(selectElement) {
            const resultDiv = document.getElementById('roughness-result');
            const value = selectElement.value;
            resultDiv.textContent = value ? `${value} mm` : '-';
        }

        function convert(id, value) {
            const val = parseFloat(value);
            const card = document.getElementById(id).closest('.converter-card');
            const conversionType = card.dataset.type;
            
            const inputs = Array.from(card.querySelectorAll('input[type="number"]'));
            if (value === '' || isNaN(val)) {
                inputs.forEach(input => { if(input.id !== id) input.value = ''; });
                if (card.querySelector('#fractional-result')) card.querySelector('#fractional-result').innerHTML = '-';
                return;
            }

            if (conversionType === 'temperature') {
                let c, f, k;
                if (id === 'celsius') { c = val; f = c * 9/5 + 32; k = c + 273.15; }
                else if (id === 'fahrenheit') { f = val; c = (f - 32) * 5/9; k = c + 273.15; }
                else { k = val; c = k - 273.15; f = c * 9/5 + 32; }
                if (document.getElementById('celsius').id !== id) document.getElementById('celsius').value = c.toPrecision(6);
                if (document.getElementById('fahrenheit').id !== id) document.getElementById('fahrenheit').value = f.toPrecision(6);
                if (document.getElementById('kelvin').id !== id) document.getElementById('kelvin').value = k.toPrecision(6);
            } else if (conversionType === 'angle') {
                if (id === 'percent') document.getElementById('deg').value = (Math.atan(val / 100) * (180 / Math.PI)).toPrecision(6);
                else document.getElementById('percent').value = (Math.tan(val * Math.PI / 180) * 100).toPrecision(6);
            } else { // Standard conversion
                const row = document.getElementById(id).closest('.conversion-row');
                const allInputs = row.querySelectorAll('input[type="number"]');
                let targetId;
                allInputs.forEach(input => {
                    if (input.id !== id) {
                        targetId = input.id;
                    }
                });

                if (targetId && factors[id]) {
                    const factor = factors[id].factor;
                    document.getElementById(targetId).value = (val * factor).toPrecision(6);
                }
                
                // Handle fractional inches special case
                const fractionalResult = card.querySelector('#fractional-result');
                if (fractionalResult) {
                    const inchInput = card.querySelector('#inch-dec');
                    if (inchInput && inchInput.value) {
                        fractionalResult.innerHTML = toFractionalInch(parseFloat(inchInput.value));
                    } else {
                         fractionalResult.innerHTML = '-';
                    }
                }
            }
        }
    </script>

</body>
</html>
